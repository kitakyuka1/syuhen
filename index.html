<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼‘æš‡æŠ½é¸ç”³ã—è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .content {
            padding: 20px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .tab-btn {
            padding: 10px 20px;
            border: none;
            background: #f0f0f0;
            border-radius: 10px;
            cursor: pointer;
            white-space: nowrap;
            font-size: 14px;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .date-list-item {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 10px;
            transition: all 0.3s;
            background: white;
        }

        .date-list-item:hover {
            border-color: #667eea;
        }

        .date-list-item.has-selection {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .date-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .date-list-left {
            flex: 1;
        }

        .date-list-date {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .date-list-day {
            font-size: 12px;
            color: #666;
        }

        .date-list-points {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }

        .date-list-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .shift-toggle {
            display: flex;
            gap: 5px;
        }

        .shift-toggle-btn {
            padding: 8px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .shift-toggle-btn:hover {
            border-color: #667eea;
        }

        .shift-toggle-btn.active {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .point-controls {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .point-btn {
            width: 36px;
            height: 36px;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: white;
            color: #667eea;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .point-btn:hover {
            background: #667eea;
            color: white;
        }

        .point-btn:active {
            transform: scale(0.95);
        }

        .point-display {
            min-width: 50px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .btn-primary {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            width: 100%;
            padding: 15px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .btn-secondary:hover {
            background: #f0f4ff;
        }

        .entry-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .entry-item {
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            margin-bottom: 10px;
            background: #fafafa;
        }

        .entry-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .entry-name {
            font-weight: bold;
            font-size: 16px;
        }

        .entry-date {
            color: #666;
            font-size: 14px;
        }

        .entry-details {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .entry-badge {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-early {
            background: #fff3cd;
            color: #856404;
        }

        .badge-late {
            background: #d1ecf1;
            color: #0c5460;
        }

        .badge-points {
            background: #e7e7ff;
            color: #667eea;
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .login-form {
            padding: 20px;
        }

        .admin-menu {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .admin-card {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .admin-card:hover {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .admin-card-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .close-modal {
            float: right;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .user-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .user-info {
            flex: 1;
        }

        .user-badge {
            padding: 4px 8px;
            background: #e7e7ff;
            color: #667eea;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸŒ¿ ä¼‘æš‡æŠ½é¸ç”³ã—è¾¼ã¿</h1>
        </div>

        <div class="content">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('application', event)">æŠ½é¸ç”³ã—è¾¼ã¿</button>
                <button class="tab-btn" onclick="switchTab('status', event)">å¿œå‹ŸçŠ¶æ³</button>
                <button class="tab-btn" onclick="switchTab('results', event)">æŠ½é¸çµæœ</button>
                <button class="tab-btn" onclick="switchTab('cancel', event)">å–ã‚Šæ¶ˆã—</button>
                <button class="tab-btn" onclick="switchTab('admin', event)">ç®¡ç†è€…</button>
            </div>

            <!-- æŠ½é¸ç”³ã—è¾¼ã¿ -->
            <div id="application" class="tab-content active">
                <div class="input-group">
                    <label>è¥Ÿç•ª</label>
                    <input type="number" id="collarNumber" placeholder="ä¾‹: 123">
                </div>
                <div class="input-group">
                    <label>åå‰</label>
                    <input type="text" id="userName" placeholder="å±±ç”° å¤ªéƒ">
                </div>

                <div class="alert alert-warning" style="margin-bottom: 20px;">
                    <strong>æ®‹ã‚Šãƒã‚¤ãƒ³ãƒˆ: <span id="remainingPoints" style="font-size: 20px; color: #667eea;">6</span> / 6</strong>
                </div>

                <div class="input-group">
                    <label>å¸Œæœ›æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„</label>
                    <div id="dateList"></div>
                </div>

                <div id="summarySection" style="margin-top: 30px;">
                    <h3 style="margin-bottom: 15px;">ç”³ã—è¾¼ã¿å†…å®¹</h3>
                    <div id="entrySummary"></div>
                    <button class="btn-primary" onclick="submitApplication()" style="margin-top: 20px;">ç”³ã—è¾¼ã¿ã‚’é€ä¿¡</button>
                </div>
            </div>

            <!-- å¿œå‹ŸçŠ¶æ³ -->
            <div id="status" class="tab-content">
                <input type="text" class="search-box" id="statusSearch" placeholder="è¥Ÿç•ªã§æ¤œç´¢..." oninput="filterStatus()">
                <div class="entry-list" id="statusList"></div>
            </div>

            <!-- æŠ½é¸çµæœ -->
            <div id="results" class="tab-content">
                <input type="text" class="search-box" id="resultsSearch" placeholder="è¥Ÿç•ªã§æ¤œç´¢..." oninput="filterResults()">
                <div class="entry-list" id="resultsList"></div>
            </div>

            <!-- å–ã‚Šæ¶ˆã— -->
            <div id="cancel" class="tab-content">
                <div class="login-form">
                    <div class="input-group">
                        <label>è¥Ÿç•ª</label>
                        <input type="number" id="cancelCollarNumber" placeholder="ä¾‹: 123">
                    </div>
                    <div class="input-group">
                        <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                        <input type="password" id="cancelPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
                    </div>
                    <button class="btn-primary" onclick="loginForCancel()">ãƒ­ã‚°ã‚¤ãƒ³</button>
                </div>
                <div id="cancelContent" style="display: none;">
                    <h3 style="margin-bottom: 15px;">ã‚ãªãŸã®å¿œå‹Ÿ</h3>
                    <div class="entry-list" id="userEntries"></div>
                </div>
            </div>

            <!-- ç®¡ç†è€… -->
            <div id="admin" class="tab-content">
                <div class="login-form" id="adminLoginForm">
                    <div class="input-group">
                        <label>ç®¡ç†è€…ID</label>
                        <input type="text" id="adminId" placeholder="admin">
                    </div>
                    <div class="input-group">
                        <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                        <input type="password" id="adminPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
                    </div>
                    <button class="btn-primary" onclick="adminLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
                </div>
                <div id="adminContent" style="display: none;">
                    <!-- è¿½åŠ : ãƒ­ã‚°ã‚¤ãƒ³ä¸­ç®¡ç†è€…æƒ…å ±ã¨æ“ä½œ -->
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <div>ãƒ­ã‚°ã‚¤ãƒ³: <strong id="currentAdminLabel"></strong></div>
                        <div style="display:flex; gap:10px;">
                            <button class="btn-secondary" onclick="openModal('adminPasswordModal')">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</button>
                            <button class="btn-secondary" onclick="adminLogout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                        </div>
                    </div>

                    <h3 style="margin-bottom: 20px;">ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼</h3>
                    <div class="admin-menu">
                        <div class="admin-card" onclick="openModal('dateSettingModal')">
                            <div class="admin-card-icon">ğŸ“…</div>
                            <div>æŠ½é¸æ—¥ç¨‹è¨­å®š</div>
                        </div>
                        <div class="admin-card" onclick="executeLottery()">
                            <div class="admin-card-icon">ğŸ²</div>
                            <div>æŠ½é¸é–‹å§‹</div>
                        </div>
                        <div class="admin-card" onclick="openModal('entryManageModal')">
                            <div class="admin-card-icon">ğŸ“</div>
                            <div>å¿œå‹Ÿç®¡ç†</div>
                        </div>
                        <div class="admin-card" onclick="openModal('overPointModal')">
                            <div class="admin-card-icon">âš ï¸</div>
                            <div>7Pä»¥ä¸Šä½¿ç”¨è€…</div>
                        </div>
                        <div class="admin-card" onclick="openModal('userManageModal')">
                            <div class="admin-card-icon">ğŸ‘¥</div>
                            <div>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</div>
                        </div>
                        <div class="admin-card" onclick="openModal('cancelHistoryModal')">
                            <div class="admin-card-icon">ğŸ“‹</div>
                            <div>å–ã‚Šæ¶ˆã—å±¥æ­´</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ«ç¾¤ -->
    <div id="dateSettingModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('dateSettingModal')">&times;</span>
            <div class="modal-header">æŠ½é¸æ—¥ç¨‹è¨­å®š</div>
            <div class="input-group">
                <label>é–‹å§‹æ—¥</label>
                <input type="date" id="lotteryStartDate">
            </div>
            <div class="input-group">
                <label>çµ‚äº†æ—¥</label>
                <input type="date" id="lotteryEndDate">
            </div>
            <div class="input-group">
                <label>å¿œå‹Ÿç· åˆ‡æ—¥æ™‚</label>
                <input type="datetime-local" id="applicationDeadline">
            </div>
            <button class="btn-primary" onclick="saveDateSettings()">è¨­å®šã‚’ä¿å­˜</button>
        </div>
    </div>

    <div id="userManageModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('userManageModal')">&times;</span>
            <div class="modal-header">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</div>
            <div class="input-group">
                <label>è¥Ÿç•ª</label>
                <input type="number" id="newUserCollar" placeholder="123">
            </div>
            <div class="input-group">
                <label>åå‰</label>
                <input type="text" id="newUserName" placeholder="å±±ç”° å¤ªéƒ">
            </div>
            <div class="input-group">
                <label>ç­</label>
                <select id="newUserTeam">
                    <option value="">ç­ã‚’é¸æŠ</option>
                    <option value="1ç­">1ç­</option>
                    <option value="2ç­">2ç­</option>
                    <option value="3ç­">3ç­</option>
                    <option value="4ç­">4ç­</option>
                    <option value="5ç­">5ç­</option>
                    <option value="6ç­">6ç­</option>
                    <option value="7ç­">7ç­</option>
                </select>
            </div>
            <div class="input-group">
                <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                <input type="password" id="newUserPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
            </div>
            <button class="btn-primary" onclick="addUser()">ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ </button>
            <h3 style="margin: 20px 0 10px 0;">ç™»éŒ²æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼</h3>
            <div class="user-list" id="userList"></div>
        </div>
    </div>

    <div id="entryManageModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('entryManageModal')">&times;</span>
            <div class="modal-header">å¿œå‹Ÿç®¡ç†</div>
            <input type="text" class="search-box" placeholder="è¥Ÿç•ªã§æ¤œç´¢..." oninput="filterAdminEntries(this.value)">
            <div class="entry-list" id="adminEntryList"></div>
        </div>
    </div>

    <div id="overPointModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('overPointModal')">&times;</span>
            <div class="modal-header">7ãƒã‚¤ãƒ³ãƒˆä»¥ä¸Šä½¿ç”¨è€…ä¸€è¦§</div>
            <div class="entry-list" id="overPointList"></div>
        </div>
    </div>

    <div id="cancelHistoryModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('cancelHistoryModal')">&times;</span>
            <div class="modal-header">å–ã‚Šæ¶ˆã—å±¥æ­´</div>
            <div class="entry-list" id="cancelHistoryList"></div>
        </div>
    </div>

    <!-- è¿½åŠ : ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="adminPasswordModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('adminPasswordModal')">&times;</span>
            <div class="modal-header">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´</div>
            <div class="input-group">
                <label>ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                <input type="password" id="adminOldPassword" placeholder="ç¾åœ¨ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
            </div>
            <div class="input-group">
                <label>æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                <input type="password" id="adminNewPassword" placeholder="æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
            </div>
            <div class="input-group">
                <label>æ–°ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆç¢ºèªï¼‰</label>
                <input type="password" id="adminNewPasswordConfirm" placeholder="ç¢ºèªç”¨">
            </div>
            <button class="btn-primary" onclick="changeAdminPassword()">å¤‰æ›´ã™ã‚‹</button>
        </div>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆãƒ¡ãƒ¢ãƒªå†…ï¼‰
        let appData = {
            entries: [],
            users: [],
            lotteryResults: [],
            cancelHistory: [],
            settings: {
                startDate: null,
                endDate: null,
                deadline: null
            },
            currentUser: {
                collarNumber: '',
                name: '',
                selections: {}
            },
            // ç¾åœ¨ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ç®¡ç†è€…ï¼ˆå­˜åœ¨ã—ãªã„å ´åˆã¯ nullï¼‰
            currentAdmin: null
        };
        
        // åˆè¨ˆãƒã‚¤ãƒ³ãƒˆè¨ˆç®—
        function getTotalPoints() {
            let total = 0;
            for (let date in appData.currentUser.selections) {
                total += appData.currentUser.selections[date].points || 0;
            }
            return total;
        }

        // åˆæœŸåŒ–
        function init() {
            generateDateList();
            updatePointsDisplay();
            loadDemoData();
        }

        // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿
        function loadDemoData() {
            // é€šå¸¸ãƒ¦ãƒ¼ã‚¶ãƒ¼
            appData.users = [
                { collar: 101, name: 'å±±ç”°å¤ªéƒ', team: '1ç­', password: 'pass123', role: 'user' },
                { collar: 102, name: 'ä½è—¤èŠ±å­', team: '1ç­', password: 'pass123', role: 'user' },
                { collar: 201, name: 'éˆ´æœ¨ä¸€éƒ', team: '2ç­', password: 'pass123', role: 'user' }
            ];

            // ç®¡ç†è€…ï¼ˆ1ç­ã€œ7ç­ã‚’ãã‚Œãã‚Œ1åãšã¤ï¼‰
            const adminBase = 900; // è¡çªã—ãªã„è¥Ÿç•ªé ˜åŸŸ
            for (let i = 1; i <= 7; i++) {
                appData.users.push({
                    collar: adminBase + i,
                    id: `admin${i}`,                // è¿½åŠ : ç®¡ç†è€…ID (admin1..admin7)
                    name: `ç®¡ç†è€… ${i}ç­`,
                    team: `${i}ç­`,
                    password: `admin${i}`,         // åˆæœŸPWã¯IDã¨åŒã˜
                    role: 'admin'
                });
            }
             refreshUserList();
         }

        // æ—¥ä»˜ãƒªã‚¹ãƒˆç”Ÿæˆ
        function generateDateList() {
            const list = document.getElementById('dateList');
            list.innerHTML = '';
            
            if (!appData.settings.startDate || !appData.settings.endDate) {
                list.innerHTML = '<div class="alert alert-warning">ç®¡ç†è€…ãŒæŠ½é¸æ—¥ç¨‹ã‚’è¨­å®šã™ã‚‹ã¾ã§ãŠå¾…ã¡ãã ã•ã„</div>';
                return;
            }
            
            const startDate = new Date(appData.settings.startDate);
            const endDate = new Date(appData.settings.endDate);
            const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];

            for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
                const year = d.getFullYear();
                const month = d.getMonth();
                const day = d.getDate();
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayName = dayNames[d.getDay()];
                
                const selection = appData.currentUser.selections[dateStr];
                const hasSelection = selection && selection.points > 0;
                
                const item = document.createElement('div');
                item.className = `date-list-item ${hasSelection ? 'has-selection' : ''}`;
                item.id = `date-item-${dateStr}`;
                item.innerHTML = `
                    <div class="date-list-header">
                        <div class="date-list-left">
                            <div class="date-list-date">${month + 1}æœˆ${day}æ—¥ï¼ˆ${dayName}ï¼‰</div>
                            <div class="date-list-day">${dateStr}</div>
                        </div>
                        <div class="date-list-points" id="points-${dateStr}">${hasSelection ? selection.points + 'P' : '-'}</div>
                    </div>
                    <div class="date-list-controls">
                        <div class="shift-toggle">
                            <button class="shift-toggle-btn ${selection?.shift === 'early' ? 'active' : ''}" onclick="toggleShift('${dateStr}', 'early', event)">â˜€ï¸ æ—©ç•ª</button>
                            <button class="shift-toggle-btn ${selection?.shift === 'late' ? 'active' : ''}" onclick="toggleShift('${dateStr}', 'late', event)">ğŸŒ™ é…ç•ª</button>
                        </div>
                        <div class="point-controls">
                            <button class="point-btn" onclick="decreasePoint('${dateStr}')">âˆ’</button>
                            <div class="point-display" id="point-value-${dateStr}">${selection?.points || 0}</div>
                            <button class="point-btn" onclick="increasePoint('${dateStr}')">ï¼‹</button>
                        </div>
                    </div>
                `;
                list.appendChild(item);
            }
        }

        // ã‚·ãƒ•ãƒˆåˆ‡ã‚Šæ›¿ãˆ
        function toggleShift(dateStr, shift, event) {
            if (!appData.currentUser.selections[dateStr]) {
                appData.currentUser.selections[dateStr] = { points: 0 };
            }
            
            appData.currentUser.selections[dateStr].shift = shift;
            
            // ãƒœã‚¿ãƒ³ã®çŠ¶æ…‹æ›´æ–°
            const item = document.getElementById(`date-item-${dateStr}`);
            if (item) {
                const buttons = item.querySelectorAll('.shift-toggle-btn');
                buttons.forEach(btn => btn.classList.remove('active'));
                const targetButton = event?.target?.closest('.shift-toggle-btn');
                if (targetButton) {
                    targetButton.classList.add('active');
                }
            }
            
            updateEntrySummary();
        }

        // ãƒã‚¤ãƒ³ãƒˆå¢—åŠ 
        function increasePoint(dateStr) {
            const current = appData.currentUser.selections[dateStr]?.points || 0;
            const total = getTotalPoints();
            
            if (total >= 6) {
                alert('åˆè¨ˆãƒã‚¤ãƒ³ãƒˆãŒ6ã‚’è¶…ãˆã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“');
                return;
            }
            
            if (!appData.currentUser.selections[dateStr]) {
                appData.currentUser.selections[dateStr] = { points: 0 };
            }
            
            appData.currentUser.selections[dateStr].points = current + 1;
            
            updateDateDisplay(dateStr);
            updatePointsDisplay();
            updateEntrySummary();
        }

        // ãƒã‚¤ãƒ³ãƒˆæ¸›å°‘
        function decreasePoint(dateStr) {
            const current = appData.currentUser.selections[dateStr]?.points || 0;
            
            if (current <= 0) {
                return;
            }
            
            appData.currentUser.selections[dateStr].points = current - 1;
            
            if (appData.currentUser.selections[dateStr].points === 0) {
                delete appData.currentUser.selections[dateStr];
            }
            
            updateDateDisplay(dateStr);
            updatePointsDisplay();
            updateEntrySummary();
        }

        // æ—¥ä»˜è¡¨ç¤ºæ›´æ–°
        function updateDateDisplay(dateStr) {
            const selection = appData.currentUser.selections[dateStr];
            const pointValueEl = document.getElementById(`point-value-${dateStr}`);
            const pointsEl = document.getElementById(`points-${dateStr}`);
            const itemEl = document.getElementById(`date-item-${dateStr}`);
            
            if (selection && selection.points > 0) {
                pointValueEl.textContent = selection.points;
                pointsEl.textContent = selection.points + 'P';
                itemEl.classList.add('has-selection');
                
                const buttons = itemEl.querySelectorAll('.shift-toggle-btn');
                buttons.forEach(btn => btn.classList.remove('active'));
                if (selection.shift) {
                    const activeButton = itemEl.querySelector(`.shift-toggle-btn[onclick*="'${selection.shift}'"]`);
                    if (activeButton) {
                        activeButton.classList.add('active');
                    }
                }
            } else {
                pointValueEl.textContent = '0';
                pointsEl.textContent = '-';
                itemEl.classList.remove('has-selection');
                
                const buttons = itemEl.querySelectorAll('.shift-toggle-btn');
                buttons.forEach(btn => btn.classList.remove('active'));
            }
        }

        // ãƒã‚¤ãƒ³ãƒˆè¡¨ç¤ºæ›´æ–°
        function updatePointsDisplay() {
            const total = getTotalPoints();
            const remaining = 6 - total;
            document.getElementById('remainingPoints').textContent = remaining;
        }

        // ç”³ã—è¾¼ã¿å†…å®¹ã‚µãƒãƒªãƒ¼æ›´æ–°
        function updateEntrySummary() {
            const summary = document.getElementById('entrySummary');
            summary.innerHTML = '';
            
            for (let date in appData.currentUser.selections) {
                const sel = appData.currentUser.selections[date];
                if (sel.points > 0) {
                    const item = document.createElement('div');
                    item.className = 'entry-item';
                    item.innerHTML = `
                        <div class="entry-item-header">
                            <span class="entry-date">${date}</span>
                            <button onclick="removeEntry('${date}')" style="background: #ff4444; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">å‰Šé™¤</button>
                        </div>
                        <div class="entry-details">
                            <span class="entry-badge ${sel.shift === 'early' ? 'badge-early' : 'badge-late'}">
                                ${sel.shift === 'early' ? 'â˜€ï¸ æ—©ç•ª' : 'ğŸŒ™ é…ç•ª'}
                            </span>
                            <span class="entry-badge badge-points">${sel.points}ãƒã‚¤ãƒ³ãƒˆ</span>
                        </div>
                    `;
                    summary.appendChild(item);
                }
            }
        }

        // ã‚¨ãƒ³ãƒˆãƒªãƒ¼å‰Šé™¤
        function removeEntry(date) {
            delete appData.currentUser.selections[date];
            updateDateDisplay(date);
            updatePointsDisplay();
            updateEntrySummary();
            generateDateList();
        }

        // ç”³ã—è¾¼ã¿é€ä¿¡
        function submitApplication() {
    const collarNumber = document.getElementById('collarNumber').value;
    const userName = document.getElementById('userName').value;

    if (!collarNumber || !userName) {
        alert('è¥Ÿç•ªã¨åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
    }

    const total = getTotalPoints();
    if (total === 0) {
        alert('å°‘ãªãã¨ã‚‚1æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
    }

    // ğŸ”½ ã“ã“ã‚’è¿½åŠ 
    for (let date in appData.currentUser.selections) {
        const sel = appData.currentUser.selections[date];
        if (sel.points > 0 && !sel.shift) {
            alert(`${date} ã®ã‚·ãƒ•ãƒˆï¼ˆæ—©ç•ªï¼é…ç•ªï¼‰ã‚’é¸æŠã—ã¦ãã ã•ã„`);
            return;
        }
    }

    const existingTotal = appData.entries
        .filter(e => e.collar === collarNumber)
        .reduce((sum, e) => sum + e.points, 0);

    if (existingTotal + total > 6) {
        alert(`ã™ã§ã«${existingTotal}ãƒã‚¤ãƒ³ãƒˆä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚åˆè¨ˆ6ãƒã‚¤ãƒ³ãƒˆã‚’è¶…ãˆã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚`);
        return;
    }

    for (let date in appData.currentUser.selections) {
        const sel = appData.currentUser.selections[date];
        if (sel.points > 0) {
            appData.entries.push({
                collar: collarNumber,
                name: userName,
                date: date,
                shift: sel.shift,
                points: sel.points,
                timestamp: new Date().toISOString()
            });
        }
    }

    alert('ç”³ã—è¾¼ã¿ãŒå®Œäº†ã—ã¾ã—ãŸï¼');

    appData.currentUser.selections = {};
    document.getElementById('collarNumber').value = '';
    document.getElementById('userName').value = '';
    updatePointsDisplay();
    updateEntrySummary();
    generateDateList();
    refreshStatusList();
}


        // å¿œå‹ŸçŠ¶æ³ãƒªã‚¹ãƒˆæ›´æ–°
        function refreshStatusList() {
            const list = document.getElementById('statusList');
            list.innerHTML = '';
            
            if (appData.entries.length === 0) {
                list.innerHTML = '<div class="alert alert-warning">ã¾ã å¿œå‹ŸãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            // æ—¥ä»˜Ã—ã‚·ãƒ•ãƒˆã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const grouped = {};
            appData.entries.forEach(entry => {
                const key = `${entry.date}-${entry.shift}`;
                if (!grouped[key]) {
                    grouped[key] = {
                        date: entry.date,
                        shift: entry.shift,
                        entries: []
                    };
                }
                grouped[key].entries.push(entry);
            });

            // æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆ
            const sortedKeys = Object.keys(grouped).sort((a, b) => {
                const dateA = grouped[a].date;
                const dateB = grouped[b].date;
                if (dateA !== dateB) return dateA.localeCompare(dateB);
                return grouped[a].shift.localeCompare(grouped[b].shift);
            });

            sortedKeys.forEach(key => {
                const group = grouped[key];
                const item = document.createElement('div');
                item.className = 'entry-item';
                
                // å¿œå‹Ÿè€…ãƒªã‚¹ãƒˆã‚’ä½œæˆ
                const participantsList = group.entries.map(e => 
                    `<div style="padding: 5px 0; border-bottom: 1px solid #e0e0e0;">
                        <span style="font-weight: bold;">è¥Ÿç•ª ${e.collar}</span> - ${e.name} 
                        <span class="entry-badge badge-points" style="margin-left: 10px;">${e.points}P</span>
                    </div>`
                ).join('');
                
                // åˆè¨ˆãƒã‚¤ãƒ³ãƒˆè¨ˆç®—
const totalPoints = group.entries.reduce((sum, e) => sum + e.points, 0);

item.innerHTML = `
    <div class="entry-item-header">
        <div>
            <div class="entry-date" style="font-size: 18px; font-weight: bold;">${group.date}</div>
            <span class="entry-badge ${group.shift === 'early' ? 'badge-early' : 'badge-late'}" style="margin-top: 5px; display: inline-block;">
                ${group.shift === 'early' ? 'â˜€ï¸ æ—©ç•ª' : 'ğŸŒ™ é…ç•ª'}
            </span>
        </div>
        <div style="text-align: right;">
    <div style="font-size: 24px; font-weight: bold; color: #667eea;">${totalPoints}P</div>
    <div style="font-size: 14px; color: #555;">${group.entries.length}å</div>
</div>

    </div>
    <div style="margin-top: 15px; padding-top: 10px; border-top: 2px solid #e0e0e0;">
        ${participantsList}
    </div>
`;

                list.appendChild(item);
            });
        }

        // å¿œå‹ŸçŠ¶æ³ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        function filterStatus() {
            const search = document.getElementById('statusSearch').value;
            const list = document.getElementById('statusList');
            list.innerHTML = '';
            
            const filtered = appData.entries.filter(e => 
                search === '' || e.collar.toString().includes(search)
            );

            if (filtered.length === 0) {
                list.innerHTML = '<div class="alert alert-warning">è©²å½“ã™ã‚‹å¿œå‹ŸãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            // æ—¥ä»˜Ã—ã‚·ãƒ•ãƒˆã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const grouped = {};
            filtered.forEach(entry => {
                const key = `${entry.date}-${entry.shift}`;
                if (!grouped[key]) {
                    grouped[key] = {
                        date: entry.date,
                        shift: entry.shift,
                        entries: []
                    };
                }
                grouped[key].entries.push(entry);
            });

            // æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆ
            const sortedKeys = Object.keys(grouped).sort((a, b) => {
                const dateA = grouped[a].date;
                const dateB = grouped[b].date;
                if (dateA !== dateB) return dateA.localeCompare(dateB);
                return grouped[a].shift.localeCompare(grouped[b].shift);
            });

            sortedKeys.forEach(key => {
                const group = grouped[key];
                const item = document.createElement('div');
                item.className = 'entry-item';
                
                // å¿œå‹Ÿè€…ãƒªã‚¹ãƒˆã‚’ä½œæˆ
                const participantsList = group.entries.map(e => 
                    `<div style="padding: 5px 0; border-bottom: 1px solid #e0e0e0;">
                        <span style="font-weight: bold;">è¥Ÿç•ª ${e.collar}</span> - ${e.name} 
                        <span class="entry-badge badge-points" style="margin-left: 10px;">${e.points}P</span>
                    </div>`
                ).join('');
                
                item.innerHTML = `
                    <div class="entry-item-header">
                        <div>
                            <div class="entry-date" style="font-size: 18px; font-weight: bold;">${group.date}</div>
                            <span class="entry-badge ${group.shift === 'early' ? 'badge-early' : 'badge-late'}" style="margin-top: 5px; display: inline-block;">
                                ${group.shift === 'early' ? 'â˜€ï¸ æ—©ç•ª' : 'ğŸŒ™ é…ç•ª'}
                            </span>
                        </div>
                        <span style="font-size: 24px; font-weight: bold; color: #667eea;">${group.entries.length}å</span>
                    </div>
                    <div style="margin-top: 15px; padding-top: 10px; border-top: 2px solid #e0e0e0;">
                        ${participantsList}
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // å–ã‚Šæ¶ˆã—ãƒ­ã‚°ã‚¤ãƒ³
        function loginForCancel() {
            const collar = document.getElementById('cancelCollarNumber').value;
            const password = document.getElementById('cancelPassword').value;
            
            const user = appData.users.find(u => 
                u.collar.toString() === collar && u.password === password
            );
        
            if (user) {
                document.querySelector('#cancel .login-form').style.display = 'none';
                document.getElementById('cancelContent').style.display = 'block';
                showUserEntries(collar);
            } else {
                alert('è¥Ÿç•ªã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
            }
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼è¡¨ç¤º
        function showUserEntries(collar) {
            const list = document.getElementById('userEntries');
            list.innerHTML = '';
            
            const userEntries = appData.entries.filter(e => e.collar.toString() === collar);
            
            if (userEntries.length === 0) {
                list.innerHTML = '<div class="alert alert-warning">ã‚ãªãŸã®å¿œå‹Ÿã¯ã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            userEntries.forEach((entry) => {
                const item = document.createElement('div');
                item.className = 'entry-item';
                item.innerHTML = `
                    <div class="entry-item-header">
                        <span class="entry-date">${entry.date}</span>
                        <button onclick="cancelEntry('${entry.collar}', '${entry.date}', '${entry.shift}', '${collar}')" style="background: #ff4444; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer;">å–ã‚Šæ¶ˆã—</button>
                    </div>
                    <div class="entry-details">
                        <span class="entry-badge ${entry.shift === 'early' ? 'badge-early' : 'badge-late'}">
                            ${entry.shift === 'early' ? 'â˜€ï¸ æ—©ç•ª' : 'ğŸŒ™ é…ç•ª'}
                        </span>
                        <span class="entry-badge badge-points">${entry.points}ãƒã‚¤ãƒ³ãƒˆ</span>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // ã‚¨ãƒ³ãƒˆãƒªãƒ¼å–ã‚Šæ¶ˆã—
        function cancelEntry(entryCollar, entryDate, entryShift, currentUserCollar) {
            if (!confirm('æœ¬å½“ã«ã“ã®å¿œå‹Ÿã‚’å–ã‚Šæ¶ˆã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }
        
            const entryIndex = appData.entries.findIndex(e => 
                e.collar.toString() === entryCollar && 
                e.date === entryDate && 
                e.shift === entryShift
            );
        
            if (entryIndex === -1) {
                alert('ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã¾ã›ã‚“ã§ã—ãŸ');
                return;
            }
        
            const entry = appData.entries[entryIndex];
            
            // å®Ÿè¡Œè€…ã®åå‰ã‚‚ä¿å­˜ï¼ˆè¦‹ã‚„ã™ãã™ã‚‹ãŸã‚ï¼‰
            const canceledByUser = appData.users.find(u => u.collar.toString() === currentUserCollar);
            appData.cancelHistory.push({
                collar: entry.collar,
                name: entry.name,
                date: entry.date,
                shift: entry.shift,
                points: entry.points,
                canceledBy: currentUserCollar,
                canceledByName: canceledByUser ? canceledByUser.name : currentUserCollar,
                canceledAt: new Date().toISOString()
            });
        
            appData.entries.splice(entryIndex, 1);
            
            alert('å¿œå‹Ÿã‚’å–ã‚Šæ¶ˆã—ã¾ã—ãŸ');
            showUserEntries(currentUserCollar);
            refreshStatusList();
        }

        // ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³
        function adminLogin() {
            const id = document.getElementById('adminId').value.trim();
            const password = document.getElementById('adminPassword').value;

            // ç®¡ç†è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯ appData.users ã« role: 'admin' ã¨ã—ã¦ç™»éŒ²ã—ã¦ã‚ã‚‹ãŸã‚ã€
            // ç®¡ç†è€…IDï¼ˆadmin1ç­‰ï¼‰ã¾ãŸã¯è¥Ÿç•ªï¼ˆæ•°å€¤ï¼‰ã¾ãŸã¯åå‰ã§èªè¨¼ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
            const admin = appData.users.find(u =>
                u.role === 'admin' &&
                (
                    (u.id && u.id === id) ||        // è¿½åŠ : ç®¡ç†è€…IDã§ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½
                    u.collar.toString() === id ||
                    u.name === id
                ) &&
                u.password === password
            );

            if (admin) {
                appData.currentAdmin = admin;
                document.getElementById('adminLoginForm').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                // ç¾åœ¨ã®ç®¡ç†è€…è¡¨ç¤ºã‚’æ›´æ–°
                const label = document.getElementById('currentAdminLabel');
                if (label) {
                    label.textContent = admin.id ? `${admin.id}ï¼ˆ${admin.team}ï¼‰` : `è¥Ÿç•ª ${admin.collar}`;
                }
            } else {
                alert('IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
            }
         }
        
        // æŠ½é¸å®Ÿè¡Œ
        function executeLottery() {
            if (!confirm('æŠ½é¸ã‚’å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }

            appData.lotteryResults = [];
            
            const groups = {};
            appData.entries.forEach(entry => {
                const key = `${entry.date}-${entry.shift}`;
                if (!groups[key]) {
                    groups[key] = [];
                }
                for (let i = 0; i < entry.points; i++) {
                    groups[key].push(entry);
                }
            });

            for (let key in groups) {
                const entries = groups[key];
                const [date, shift] = key.split('-');
                
                const shuffled = entries.sort(() => Math.random() - 0.5);
                
                shuffled.forEach((entry, index) => {
                    appData.lotteryResults.push({
                        collar: entry.collar,
                        name: entry.name,
                        date: date,
                        shift: shift,
                        number: index + 1,
                        drawnAt: new Date().toISOString()
                    });
                });
            }

            alert('æŠ½é¸ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
            refreshResultsList();
        }

        // æŠ½é¸çµæœãƒªã‚¹ãƒˆæ›´æ–°
        function refreshResultsList() {
            const list = document.getElementById('resultsList');
            list.innerHTML = '';

            if (appData.lotteryResults.length === 0) {
                list.innerHTML = '<div class="alert alert-warning">ã¾ã æŠ½é¸ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';
                return;
            }

            // æ—¥ä»˜ã”ã¨ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const grouped = {};
            appData.lotteryResults.forEach(result => {
                if (!grouped[result.date]) grouped[result.date] = [];
                grouped[result.date].push(result);
            });

            // æ—¥ä»˜æ˜‡é †ã§è¡¨ç¤º
            const sortedDates = Object.keys(grouped).sort();

            sortedDates.forEach(date => {
                // æ—¥ä»˜è¦‹å‡ºã—
                const dateHeader = document.createElement('div');
                dateHeader.style.cssText = 'font-size:18px;font-weight:bold;margin:18px 0 8px 0;color:#667eea;';
                dateHeader.textContent = `${date}`;
                list.appendChild(dateHeader);

                // ãã®æ—¥ä»˜å†…ã§é †ä½é †
                const results = grouped[date].sort((a, b) => a.number - b.number);
                results.forEach(result => {
                    const item = document.createElement('div');
                    item.className = 'entry-item';
                    item.innerHTML = `
                        <div class="entry-item-header">
                            <span class="entry-name">è¥Ÿç•ª ${result.collar} - ${result.name}</span>
                            <span style="font-size: 24px; font-weight: bold; color: #667eea;">#${result.number}</span>
                        </div>
                        <div class="entry-details">
                            <span class="entry-date">${result.date}</span>
                            <span class="entry-badge ${result.shift === 'early' ? 'badge-early' : 'badge-late'}">
                                ${result.shift === 'early' ? 'â˜€ï¸ æ—©ç•ª' : 'ğŸŒ™ é…ç•ª'}
                            </span>
                        </div>
                    `;
                    list.appendChild(item);
                });
            });
        }

        // æŠ½é¸çµæœãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        function filterResults() {
            const search = document.getElementById('resultsSearch').value;
            const list = document.getElementById('resultsList');
            list.innerHTML = '';
            
            const filtered = appData.lotteryResults.filter(r => 
                search === '' || r.collar.toString().includes(search)
            );

            if (filtered.length === 0) {
                list.innerHTML = '<div class="alert alert-warning">è©²å½“ã™ã‚‹çµæœãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            const sorted = filtered.sort((a, b) => {
                if (a.date !== b.date) return a.date.localeCompare(b.date);
                if (a.shift !== b.shift) return a.shift.localeCompare(b.shift);
                return a.number - b.number;
            });

            sorted.forEach(result => {
                const item = document.createElement('div');
                item.className = 'entry-item';
                item.innerHTML = `
                    <div class="entry-item-header">
                        <span class="entry-name">è¥Ÿç•ª ${result.collar} - ${result.name}</span>
                        <span style="font-size: 24px; font-weight: bold; color: #667eea;">#${result.number}</span>
                    </div>
                    <div class="entry-details">
                        <span class="entry-date">${result.date}</span>
                        <span class="entry-badge ${result.shift === 'early' ? 'badge-early' : 'badge-late'}">
                            ${result.shift === 'early' ? 'â˜€ï¸ æ—©ç•ª' : 'ğŸŒ™ é…ç•ª'}
                        </span>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿½åŠ 
        function addUser() {
            const collar = document.getElementById('newUserCollar').value;
            const name = document.getElementById('newUserName').value;
            const team = document.getElementById('newUserTeam').value;
            const password = document.getElementById('newUserPassword').value;

            if (!collar || !name || !team || !password) {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            appData.users.push({
                collar: parseInt(collar),
                name: name,
                team: team,
                password: password
            });

            document.getElementById('newUserCollar').value = '';
            document.getElementById('newUserName').value = '';
            document.getElementById('newUserTeam').value = '';
            document.getElementById('newUserPassword').value = '';

            alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
            refreshUserList();
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆæ›´æ–°
        function refreshUserList() {
            const list = document.getElementById('userList');
            list.innerHTML = '';

            const teams = {};
            appData.users.forEach(user => {
                if (!teams[user.team]) {
                    teams[user.team] = [];
                }
                teams[user.team].push(user);
            });

            for (let team in teams) {
                const teamHeader = document.createElement('div');
                teamHeader.style.cssText = 'font-weight: bold; padding: 10px; background: #f0f0f0; margin-top: 10px;';
                teamHeader.textContent = team;
                list.appendChild(teamHeader);

                teams[team].forEach(user => {
                    const item = document.createElement('div');
                    item.className = 'user-item';
                    item.innerHTML = `
                        <div class="user-info">
                            <div style="font-weight: bold;">${user.name}</div>
                            <div style="font-size: 12px; color: #666;">è¥Ÿç•ª: ${user.collar}</div>
                        </div>
                        <span class="user-badge">${user.team}</span>
                    `;
                    list.appendChild(item);
                });
            }
        }

        // ç®¡ç†è€…ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒªã‚¹ãƒˆæ›´æ–°
        function refreshAdminEntryList() {
            const list = document.getElementById('adminEntryList');
            list.innerHTML = '';

            if (appData.entries.length === 0) {
                list.innerHTML = '<div class="alert alert-warning">å¿œå‹ŸãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            appData.entries.forEach((entry, index) => {
                const item = document.createElement('div');
                item.className = 'entry-item';
                item.innerHTML = `
                    <div class="entry-item-header">
                        <span class="entry-name">è¥Ÿç•ª ${entry.collar} - ${entry.name}</span>
                        <button onclick="deleteEntryAdmin(${index})" style="background: #ff4444; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">å‰Šé™¤</button>
                    </div>
                    <div class="entry-details">
                        <span class="entry-date">${entry.date}</span>
                        <span class="entry-badge ${entry.shift === 'early' ? 'badge-early' : 'badge-late'}">
                            ${entry.shift === 'early' ? 'â˜€ï¸ æ—©ç•ª' : 'ğŸŒ™ é…ç•ª'}
                        </span>
                        <span class="entry-badge badge-points">${entry.points}ãƒã‚¤ãƒ³ãƒˆ</span>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // ç®¡ç†è€…ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        function filterAdminEntries(search) {
            const list = document.getElementById('adminEntryList');
            list.innerHTML = '';

            const filtered = appData.entries.filter(e => 
                search === '' || e.collar.toString().includes(search)
            );

            if (filtered.length === 0) {
                list.innerHTML = '<div class="alert alert-warning">è©²å½“ã™ã‚‹å¿œå‹ŸãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }

            filtered.forEach((entry) => {
                const item = document.createElement('div');
                item.className = 'entry-item';
                const originalIndex = appData.entries.indexOf(entry);
                item.innerHTML = `
                    <div class="entry-item-header">
                        <span class="entry-name">è¥Ÿç•ª ${entry.collar} - ${entry.name}</span>
                        <button onclick="deleteEntryAdmin(${originalIndex})" style="background: #ff4444; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">å‰Šé™¤</button>
                    </div>
                    <div class="entry-details">
                        <span class="entry-date">${entry.date}</span>
                        <span class="entry-badge ${entry.shift === 'early' ? 'badge-early' : 'badge-late'}">
                            ${entry.shift === 'early' ? 'â˜€ï¸ æ—©ç•ª' : 'ğŸŒ™ é…ç•ª'}
                        </span>
                        <span class="entry-badge badge-points">${entry.points}ãƒã‚¤ãƒ³ãƒˆ</span>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // ç®¡ç†è€…ã‚¨ãƒ³ãƒˆãƒªãƒ¼å‰Šé™¤
        function deleteEntryAdmin(index) {
    if (!confirm('ã“ã®å¿œå‹Ÿã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
    }
    
    const entry = appData.entries[index];
    
    // ğŸ”½ å±¥æ­´ã«è¿½åŠ ï¼ˆç®¡ç†è€…å‰Šé™¤ï¼‰
    const admin = appData.currentAdmin;
    appData.cancelHistory.push({
        collar: entry.collar,
        name: entry.name,
        date: entry.date,
        shift: entry.shift,
        points: entry.points,
        canceledBy: admin ? admin.collar : 'ç®¡ç†è€…',
        canceledByName: admin ? admin.name : 'ç®¡ç†è€…',
        canceledAt: new Date().toISOString()
    });
    
    // å¿œå‹Ÿãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å‰Šé™¤
    appData.entries.splice(index, 1);
    
    // è¡¨ç¤ºæ›´æ–°
    refreshAdminEntryList();
    alert('å‰Šé™¤ã—ã¾ã—ãŸ');
    
    // ğŸ”½ å±¥æ­´ç”»é¢ãŒé–‹ã„ã¦ã„ãŸã‚‰å³åæ˜ 
    refreshCancelHistory();
}
        
        
        // 7ãƒã‚¤ãƒ³ãƒˆä»¥ä¸Šä½¿ç”¨è€…ãƒªã‚¹ãƒˆæ›´æ–°
        function refreshOverPointList() {
            const list = document.getElementById('overPointList');
            list.innerHTML = '';

            const userPoints = {};
            appData.entries.forEach(entry => {
                if (!userPoints[entry.collar]) {
                    userPoints[entry.collar] = {
                        name: entry.name,
                        total: 0
                    };
                }
                userPoints[entry.collar].total += entry.points;
            });

            const overUsers = Object.entries(userPoints).filter(([collar, data]) => data.total >= 7);

            if (overUsers.length === 0) {
                list.innerHTML = '<div class="alert alert-success">7ãƒã‚¤ãƒ³ãƒˆä»¥ä¸Šä½¿ç”¨ã—ã¦ã„ã‚‹äººã¯ã„ã¾ã›ã‚“</div>';
                return;
            }

            overUsers.forEach(([collar, data]) => {
                const item = document.createElement('div');
                item.className = 'entry-item';
                item.style.borderLeft = '4px solid #ff4444';
                item.innerHTML = `
                    <div class="entry-item-header">
                        <span class="entry-name">è¥Ÿç•ª ${collar} - ${data.name}</span>
                        <span style="font-size: 24px; font-weight: bold; color: #ff4444;">${data.total}P</span>
                    </div>
                    <div class="alert alert-warning" style="margin-top: 10px; margin-bottom: 0;">
                        âš ï¸ ãƒã‚¤ãƒ³ãƒˆãŒä¸Šé™ã‚’è¶…ãˆã¦ã„ã¾ã™
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // å–ã‚Šæ¶ˆã—å±¥æ­´æ›´æ–°
        function refreshCancelHistory() {
            const list = document.getElementById('cancelHistoryList');
            list.innerHTML = '';
        
            if (appData.cancelHistory.length === 0) {
                list.innerHTML = '<div class="alert alert-warning">å–ã‚Šæ¶ˆã—å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                return;
            }
        
            [...appData.cancelHistory].reverse().forEach(log => {
                const item = document.createElement('div');
                item.className = 'entry-item';
                const cancelDate = new Date(log.canceledAt);
                item.innerHTML = `
                    <div class="entry-item-header">
                        <span class="entry-name">è¥Ÿç•ª ${log.collar} - ${log.name}</span>
                        <span style="font-size: 12px; color: #666;">${cancelDate.toLocaleString('ja-JP')}</span>
                    </div>
                    <div class="entry-details">
                        <span class="entry-date">${log.date}</span>
                        <span class="entry-badge ${log.shift === 'early' ? 'badge-early' : 'badge-late'}">
                            ${log.shift === 'early' ? 'â˜€ï¸ æ—©ç•ª' : 'ğŸŒ™ é…ç•ª'}
                        </span>
                        <span class="entry-badge badge-points">${log.points}ãƒã‚¤ãƒ³ãƒˆ</span>
                    </div>
                    <div style="margin-top: 8px; font-size: 12px; color: #666;">
                        å–ã‚Šæ¶ˆã—å®Ÿè¡Œè€…: ${log.canceledByName ? `è¥Ÿç•ª ${log.canceledBy}ï¼ˆ${log.canceledByName}ï¼‰` : `è¥Ÿç•ª ${log.canceledBy}`}
                    </div>
                `;
                list.appendChild(item);
            });
        }

        // æ—¥ç¨‹è¨­å®šä¿å­˜
        function saveDateSettings() {
            const startDate = document.getElementById('lotteryStartDate').value;
            const endDate = document.getElementById('lotteryEndDate').value;
            const deadline = document.getElementById('applicationDeadline').value;

            if (!startDate || !endDate || !deadline) {
                alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            appData.settings = {
                startDate: startDate,
                endDate: endDate,
                deadline: deadline
            };

            alert('æ—¥ç¨‹è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            closeModal('dateSettingModal');
            generateDateList();
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName, event) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            if (event && event.target) {
                event.target.classList.add('active');
            }

            if (tabName === 'status') {
                refreshStatusList();
            } else if (tabName === 'results') {
                refreshResultsList();
            }
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«æ“ä½œ
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            
            if (modalId === 'entryManageModal') {
                refreshAdminEntryList();
            } else if (modalId === 'overPointModal') {
                refreshOverPointList();
            } else if (modalId === 'cancelHistoryModal') {
                refreshCancelHistory();
            } else if (modalId === 'userManageModal') {
                refreshUserList();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        window.onload = init;
    </script>
</body>
</html>